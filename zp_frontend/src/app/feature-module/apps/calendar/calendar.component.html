<!-- Page Content -->
<div class="content container-fluid">

	<!-- Page Header -->
	<div class="page-header">
		<div class="row align-items-center">
			<div class="col">
				<h3 class="page-title">Events</h3>
				<ul class="breadcrumb">
					<li class="breadcrumb-item"><a [routerLink]="routes.adminDashboard">Dashboard</a></li>
					<li class="breadcrumb-item active">Events</li>
				</ul>
			</div>
			<div class="col-auto float-end ms-auto" *ngIf="this.permissions.includes('add_events')">
				<a class="btn add-btn" data-bs-toggle="modal" data-bs-target="#add_event">
					<i class="fa-solid fa-plus"></i> Add Event
				</a>
			</div>
			<div class="col-auto float-end ms-auto" *ngIf="this.permissions.includes('add_meetingroomreservation')">
				<a  class="btn add-btn" data-bs-toggle="modal" data-bs-target="#book">
					<i class="fa-solid fa-plus"></i> Book Meeting Room
				</a>
			</div>
			
		</div>
	</div>
	<!-- /Page Header -->

	<div class="row">
		<div class="col-lg-12">
			<div class="card mb-0">
				<div class="card-body">
					<div class="row">
						<div class="col-md-12">

							<!-- Calendar -->
							<full-calendar *ngIf='calendarVisible' [options]='calendarOptions'>
								<ng-template #eventContent let-arg>
									<div class="event-content" tooltip="{{arg.event.extendedProps.description}}" data-container="body" data-bs-toggle="tooltip" placement="top">
									  <i><img class="avatar" [src]="arg.event.extendedProps.user?.profile_photo || image" /></i>
									  <i class="event-title">{{ arg.event.title }}</i>
									  <!-- <br>
									  <i>{{ arg.event.start | date: 'h:mm a' }}</i> -> <i>{{ arg.event.end | date: 'h:mm a' }}</i> -->
									</div>
								</ng-template>								  
							</full-calendar>
							<!-- /Calendar -->

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- /Page Content -->
<div class="modal custom-modal fade" id="delete_event" role="dialog" >
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <h3>Delete Event</h3>
                    <p>Are you sure want to delete?</p>
                </div>
                <div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
                            <a  class="btn btn-primary continue-btn"
                            (click)="deleteEvent()">Delete</a>
                        </div>
                        <div class="col-6">
                            <a  data-bs-dismiss="modal"
                                class="btn btn-primary cancel-btn">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="book" class="modal custom-modal fade" role="dialog" (hidden.bs.modal)="resetForm()">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Book Room</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"  (click)="resetForm()">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form [formGroup]="meetingRoomForm">
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Room</label>
						<mat-form-field>
							<mat-select class="select mat-cust-select" formControlName="room">
								<mat-option *ngFor="let m of meetingRooms" [value]="m.id">
									<span> {{ m.name}}</span>
								</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="input-block mb-3 date-input">
						<label class="col-form-label" for="">Date <span class="text-danger">*</span></label>
						<div class="cal-icon">
							<input class="form-control datetimepicker" bsDatepicker type="text" container=".date-input" formControlName="date"
							[ngClass]="{'is-invalid':g['date'].invalid && isBokkingSubmited ,
													'is-valid':g['date'].valid && isBokkingSubmited }">
                            <div *ngIf="g['date'] && isBokkingSubmited" class="text-danger">
                                <div
                                    *ngIf="g['date'].errors">
                                    Invalid Date</div>
                            </div>
						</div>
					</div>
						<div class="input-block mb-3" *ngIf="model.formatDate(meetingRoomForm.value.start_day)==model.formatDate(meetingRoomForm.value.end_day)">
							<label class="col-form-label" for="">Start Time <span class="text-danger">*</span></label>
							<div class="input-group time timepicker">
								<input (click)="toggleTimePcker('StartTime')" readonly [value]="formatTime(zones)"
									class="form-control"><span class="input-group-text" >
										<i class="fa-regular fa-clock"></i></span>
								<timepicker [class.show-sub-menu]="showTimePicker[0]==='StartTime'" [minuteStep]="1" 
									class="custom-timepicker" [ngModelOptions]="{standalone: true}" [(ngModel)]="zones"></timepicker>
									
							</div>
							<div class="text-danger"
                                    *ngIf="invalidHours && isBokkingSubmited">
                                    Invalid Hour</div>
						</div>

						<div class="input-block mb-3" *ngIf="model.formatDate(meetingRoomForm.value.start_day)==model.formatDate(meetingRoomForm.value.end_day)">
							<label class="col-form-label" for="">End Time <span class="text-danger">*</span></label>
							<div class="input-group time timepicker">
								<input (click)="toggleTimePcker('newTime')" readonly [value]="formatTime(setTime)"
									class="form-control"><span class="input-group-text" >
										<i class="fa-regular fa-clock"></i></span>
								<timepicker [class.show-sub-menu]="showTimePicker[0]==='newTime'"
									class="custom-timepicker" 
									[ngModelOptions]="{standalone: true}" [(ngModel)]="setTime" [min]="zones"   [minuteStep]="1"></timepicker>
									
							</div>
							<div class="text-danger"
                                    *ngIf="invalidHours &&isBokkingSubmited">
                                    Invalid Hour</div>
						</div>
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Purpose <span class="text-danger">*</span></label>
						<textarea rows="4" class="form-control" formControlName="purpose"
						[ngClass]="{'is-invalid':g['purpose'].invalid &&isBokkingSubmited ,
													'is-valid':g['purpose'].valid &&isBokkingSubmited}"></textarea>
                            <div *ngIf="g['purpose'] &&isBokkingSubmited" class="text-danger">
                                <div
                                    *ngIf="g['purpose'].errors">
                                    Purpose Require</div>
                            </div>
					</div>
					<div class="submit-section">
						<button class="btn btn-primary submit-btn" (click)="bookMeetingRoom()">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- Add Event Modal -->
<div id="add_event" class="modal custom-modal fade" role="dialog" (hidden.bs.modal)="resetForm()">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Event</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="resetForm()">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form [formGroup]="eventForm">
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Event Title <span class="text-danger">*</span></label>
						<input class="form-control" type="text" formControlName="title"
						[ngClass]="{'is-invalid':f['title'].invalid && isEventSubmited,
													'is-valid':f['title'].valid && isEventSubmited }">
                            <div *ngIf="f['title'] && isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="f['title'].errors">
                                    Title required</div>
                            </div>
					</div>
					<div class="input-block mb-3 date-input1">
						<label class="col-form-label" for="">Start Date <span class="text-danger">*</span></label>
						<div class="cal-icon">
							<input class="form-control datetimepicker" bsDatepicker type="text" container=".date-input1" formControlName="start_day"
							[minDate]="today"
							[ngClass]="{'is-invalid':(f['start_day'].invalid || invalidDates)&& isEventSubmited ,
													'is-valid':(f['start_day'].valid && !invalidDates) && isEventSubmited }">
                            <div *ngIf="(f['start_day'].invalid || invalidDates) && isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="f['start_day'].errors || invalidDates">
                                   Invalid Date</div>
                            </div>
						</div>
					</div>
					<div class="input-block mb-3 date-input2">
						<label class="col-form-label" for="">End Date <span class="text-danger">*</span></label>
						<div class="cal-icon">
							<input class="form-control datetimepicker" bsDatepicker type="text" container=".date-input2" formControlName="end_day" [minDate]="this.eventForm.value.start_day" (change)="invalidDates=false"
							[ngClass]="{'is-invalid':(f['end_day'].invalid || invalidDates)&& isEventSubmited ,
													'is-valid':(f['end_day'].valid && !invalidDates) && isEventSubmited  }">
                            <div *ngIf="(f['end_day'] || invalidDates)&& isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="f['end_day'].errors || invalidDates">
                                   Invalid Date</div>
                            </div>
						</div>
					</div>
						<div class="input-block mb-3" *ngIf="model.formatDate(eventForm.value.start_day)==model.formatDate(eventForm.value.end_day)">
							<label class="col-form-label" for="">Start Time <span class="text-danger">*</span></label>
							<div class="input-group time timepicker">
								<input (click)="toggleTimePcker('StartTime')" readonly [value]="formatTime(zones)"
									class="form-control"><span class="input-group-text" >
										<i class="fa-regular fa-clock"></i></span>
								<timepicker [class.show-sub-menu]="showTimePicker[0]==='StartTime'" [minuteStep]="1" 
									class="custom-timepicker" [ngModelOptions]="{standalone: true}" [(ngModel)]="zones"></timepicker>
							</div>
							<div class="text-danger"
                                    *ngIf="invalidHours && isEventSubmited">
                                    Invalid Date</div>
						</div>

						<div class="input-block mb-3" *ngIf="model.formatDate(eventForm.value.start_day)==model.formatDate(eventForm.value.end_day)">
							<label class="col-form-label" for="">End Time <span class="text-danger">*</span></label>
							<div class="input-group time timepicker">
								<input (click)="toggleTimePcker('newTime')" readonly [value]="formatTime(setTime)"
									class="form-control"><span class="input-group-text" >
										<i class="fa-regular fa-clock"></i></span>
								<timepicker [class.show-sub-menu]="showTimePicker[0]==='newTime'"
									class="custom-timepicker" 
									[ngModelOptions]="{standalone: true}" [(ngModel)]="setTime" [min]="zones"   [minuteStep]="1"></timepicker>
							</div>
							<div class="text-danger"
                                    *ngIf="invalidHours && isEventSubmited">
                                    Invalid Date</div>
						</div>
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Description <span class="text-danger">*</span></label>
						<textarea rows="4" class="form-control" formControlName="description"
						[ngClass]="{'is-invalid':f['description'].invalid &&isEventSubmited ,
													'is-valid':f['description'].valid &&isEventSubmited}"></textarea>
                            <div *ngIf="f['description'] &&isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="f['description'].errors">
                                    Description Require</div>
                            </div>

					</div>
					<div class="submit-section">
						<button class="btn btn-primary submit-btn" (click)="addEvent()">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- /Add Event Modal -->

<!-- Edit Event Modal -->
<div id="edit_event" class="modal custom-modal fade" role="dialog">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Edit Event</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form [formGroup]="editEventForm">
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Event Title <span class="text-danger">*</span></label>
						<input class="form-control" type="text" formControlName="title"
						[ngClass]="{'is-invalid':z['title'].invalid && isEventSubmited,
													'is-valid':z['title'].valid && isEventSubmited }">
                            <div *ngIf="z['title'] && isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="z['title'].errors">
                                    Title required</div>
                            </div>
					</div>
					<div class="input-block mb-3">
						<label class="col-form-label" for="">Description <span class="text-danger">*</span></label>
						<textarea rows="4" class="form-control" formControlName="description"
						[ngClass]="{'is-invalid':z['description'].invalid &&isEventSubmited ,
													'is-valid':z['description'].valid &&isEventSubmited}"></textarea>
                            <div *ngIf="z['description'] &&isEventSubmited" class="text-danger">
                                <div
                                    *ngIf="z['description'].errors">
                                    Description Require</div>
                            </div>

					</div>
					<div class="submit-section">
						<button class="btn btn-primary submit-btn" (click)="editEvent()">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- /Edit Event Modal -->

<!-- Event Modal -->
<div class="modal custom-modal fade" id="event-modal">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Event</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
							<button type="button" class="btn btn-success submit-btn save-event" data-bs-toggle="modal" data-bs-target="#edit_event">Edit</button>
						</div>
						<div class="col-6">
							<button type="button" class="btn btn-danger submit-btn delete-event" data-bs-toggle="modal" data-bs-target="#delete_event" >Delete</button>
						</div>
					</div>
			</div>
		</div>
	</div>
</div>
</div>
<!-- /Event Modal -->

