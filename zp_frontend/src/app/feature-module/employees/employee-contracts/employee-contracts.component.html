<!-- Page Content -->
<div class="content container-fluid">

    <!-- Page Header -->
    <div class="page-header">
        <div class="row">
            <div class="col-sm-12">
                <h3 class="page-title">Contracts</h3>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a [routerLink]="routes.adminDashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active">Contracts</li>
                </ul>
            </div>
            <div class="col-auto float-end ms-auto">
                <a class="btn add-btn" *ngIf="this.permissions.includes('add_user')" data-bs-toggle="modal" data-bs-target="#add_contract"><i class="fa-solid fa-plus"></i> Add Contract</a>
            </div>
        </div>
    </div>
    <!-- /Page Header -->

    <div class="row">
        <div class="col-md-12">
            <div class="table_header">
                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="dataTables_length">
                            <label>
                                Show
                                <select [(ngModel)]="pageSize" (ngModelChange)="changePageSize()"
                                    class="form-control form-control-sm">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                Entries
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table matSort class="table table-striped custom-table datatable mb-0">
                  <thead>
                    <tr>
                        <th rowspan="2" class="text-top">ID</th>
                        <th rowspan="2" class="text-top">Name</th>
                        <th rowspan="2" class="text-top">Position</th>
                        <th rowspan="2" class="text-top">Hiring Date</th>
                        <th colspan="4" class="text-center">1st Contract</th>
                        <th colspan="4" class="text-center">2nd Contract</th>
                    </tr>
                    <tr>
                      <th>Start</th>
                      <th>End</th>
                      <th>Type</th>
                      <th>Salary</th>
                      <th> </th>
                      <th>Start</th>
                      <th>End</th>
                      <th>Type</th>
                      <th>Salary</th>
                      <th> </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let employee of allPayments">
                      <td>{{ employee.id }}</td>
                      <td>{{ employee.name }}</td>
                      <td>{{ employee.position }}</td>
                      <td>{{ employee.hiring_date }}</td>
                      <ng-container *ngFor="let contract of employee.contracts; let i = index">
                        <td>{{ contract.start_date || 'N/A' }}</td>
                        <td>{{ contract.end_date || 'N/A' }}</td>
                        <td>{{ contract.contract_type || 'N/A' }}</td>
                        <td>{{ contract.salary || 'N/A' }}</td>
                        <td><div class="dropdown dropdown-action">
                            <a
                              class="action-icon dropdown-toggle"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              ><i class="material-icons">more_vert</i></a
                            >
                            <div class="dropdown-menu dropdown-menu-right">
                              <a (click)="passContractData(contract)"
                                class="dropdown-item"
                                data-bs-toggle="modal"
                                data-bs-target="#edit_contract"
                                ><i class="fa-solid fa-pencil m-r-5"></i> Edit</a
                              >
                              <a (click)="passContractData(contract)"
                                class="dropdown-item"
                                data-bs-toggle="modal"
                                data-bs-target="#delete_contract"
                                ><i class="fa-regular fa-trash-can m-r-5"></i> Delete</a
                              >
                            </div>
                          </div></td>
                      </ng-container>
                      <!-- Fill the remaining columns if the number of contracts is less than 3 -->
                      <ng-container *ngIf="employee.contracts.length < 3">
                        <ng-container *ngFor="let empty of [].constructor((2 - employee.contracts.length) * 5)">
                          <td></td>
                        </ng-container>
                      </ng-container>
                    </tr>
                    <tr *ngIf="allPayments.length === 0">
                      <td colspan="16">
                        <h5 style="text-align: center;">No data found</h5>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
            <div class="table_footer">
                <div class="col-sm-12 col-md-5">
                    <div class="dataTables_info">
                        Showing {{ serialNumberArray[0] }} to
                        {{ serialNumberArray[serialNumberArray.length - 1] }} of
                        {{ totalData }} entries
                    </div>
                </div>

                <div class="col-sm-12 col-md-7">
                    <div class="pagination_section">
                        <ul class="pagination">
                            <li class="page-item" [ngClass]="{
                          disabled: currentPage === 1
                        }">
                                <a (click)="getMoreData('previous')" class="page-link" href="javascript:void(0);"
                                    tabindex="-1">Previous</a>
                            </li>

                            <ng-container *ngFor="let item of pageNumberArray; let i = index">
                                <li class="page-item" [class.active]="item === currentPage" [ngClass]="
                            (pageNumberArray[currentPage - 2] > item &&
                              item !== 1 &&
                              pageNumberArray.length > 6) ||
                            (pageNumberArray[currentPage] < item &&
                              item !== 1 &&
                              pageNumberArray.length > 6 &&
                              pageNumberArray.length !== item)
                              ? 'hide-page-no'
                              : 'show-page-no'
                          ">
                                    <a (click)="moveToPage(item)" class="page-link" href="javascript:void(0);">
                                        {{ item }}
                                    </a>
                                </li>
                                <li class="page-item" *ngIf="
                            i === 0 && pageNumberArray.length > 6 && currentPage > 2
                          " [hidden]="currentPage === 1" (click)="moveToPage(currentPage - 2)" (keydown.enter)="moveToPage(currentPage - 2)" tabindex="0">
                                    <a class="page-link" href="javascript:void(0);"> ... </a>
                                </li>
                                <li *ngIf="
                            i === pageNumberArray.length - 2 &&
                            pageNumberArray.length > 6
                          " [hidden]="
                            currentPage >=
                              pageNumberArray[pageNumberArray.length - 2] ||
                            totalData < serialNumberArray[serialNumberArray.length - 1]
                          " class="page-item" (click)="moveToPage(currentPage + 2)" (keydown.enter)="moveToPage(currentPage + 2)" tabindex="0">
                                    <a class="page-link" href="javascript:void(0);"> ... </a>
                                </li>
                            </ng-container>

                            <li class="page-item" [ngClass]="{
                          disabled:
                            currentPage ===
                              pageNumberArray[pageNumberArray.length - 1] ||
                            allPayments.length === 0
                        }">
                                <a (click)="getMoreData('next')" class="page-link" href="javascript:void(0);">Next
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Page Content -->

<div id="add_contract" class="modal custom-modal fade" role="dialog" (hidden.bs.modal)="resetForm()">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Contract</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="resetForm()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="addContractForm">
                    <!-- <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="showErrorAlert">
                        <strong>Error:</strong> An error occurred while adding the contract, {{ errorMessage }}
                    </div> -->
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                            <label class="col-form-label" for="type">Employee</label>
                              <mat-form-field>
                                <mat-select id="year" class="select mat-cust-select" formControlName="user">
                                  <mat-option *ngFor="let employee of employees " [value]="employee.id">{{employee.firstname}} {{employee.lastname}}</mat-option>
                                </mat-select>
                              </mat-form-field>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="type">Type</label>
                                <input class="form-control" type="text"
                                    [ngClass]="{ 'is-invalid': submitted && f['contract_type'].errors,
                                    'is-valid': !submitted && f['contract_type'].valid }"
                                    formControlName="contract_type">
                                <div *ngIf="submitted && f['contract_type']" class="invalid-feedback">
                                    <div *ngIf="f['contract_type'].errors && f['contract_type'].errors['required']">Type is required</div>
                                </div>
                                <div *ngIf="!submitted && f['contract_type'].valid" class="valid-feedback">Its ok!</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="startDate">Start Date</label>
                                <input class="form-control datetimepicker" bsDatepicker type="text" container=".date-input" 
                                    [ngClass]="{ 'is-invalid': submitted && f['start_date'].errors,
                                    'is-valid': !submitted && f['start_date'].valid }"
                                    formControlName="start_date">
                                <div *ngIf="submitted && f['start_date']" class="invalid-feedback">
                                    <div *ngIf="f['start_date'].errors && f['start_date'].errors['required']">Start Date is required</div>
                                </div>
                                <div *ngIf="!submitted && f['start_date'].valid" class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="endDate">End Date</label>
                                <input class="form-control datetimepicker" bsDatepicker type="text" container=".date-input"
                                    formControlName="end_date">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="salary">Salary</label>
                                <input class="form-control" type="number"
                                    [ngClass]="{ 'is-invalid': submitted && f['salary'].errors,
                                    'is-valid': !submitted && f['salary'].valid }"
                                    formControlName="salary">
                                <div *ngIf="submitted && f['salary']" class="invalid-feedback">
                                    <div *ngIf="f['salary'].errors && f['salary'].errors['required']">Salary is required</div>
                                </div>
                                <div *ngIf="!submitted && f['salary'].valid" class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
                    </div>
                    <div class="submit-section">
                        <button class="btn btn-primary submit-btn" type="button" (click)="addContract()">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="edit_contract" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Contract</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="resetForm()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="editContractForm">
                    <!-- <div class="alert alert-danger alert-dismissible fade show" role="alert" *ngIf="showErrorAlert">
                        <strong>Error:</strong> An error occurred while adding the contract, {{ errorMessage }}
                    </div> -->
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="type">Type</label>
                                <input class="form-control" type="text" 
                                    [ngClass]="{ 'is-invalid': submitted && g['contract_type'].errors,
                                    'is-valid': submitted && g['contract_type'].valid }"
                                    formControlName="contract_type">
                                <div *ngIf="submitted && g['contract_type']" class="invalid-feedback">
                                    <div *ngIf="g['contract_type'].errors && g['contract_type'].errors['required']">Type is required</div>
                                </div>
                                <div *ngIf="submitted && g['contract_type'].valid" class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="startDate">Start Date</label>
                                <input class="form-control datetimepicker"  bsDatepicker type="text" container=".date-input" 
                                    [ngClass]="{ 'is-invalid': submitted && g['start_date'].errors,
                                    'is-valid': submitted && g['start_date'].valid }"
                                    formControlName="start_date">
                                <div *ngIf="submitted && g['start_date']" class="invalid-feedback">
                                    <div *ngIf="g['start_date'].errors && g['start_date'].errors['required']">Start Date is required</div>
                                </div>
                                <div *ngIf="submitted && g['start_date'].valid" class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="endDate">End Date</label>
                                <input class="form-control datetimepicker"  bsDatepicker type="text" container=".date-input"
                                    formControlName="end_date">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-block mb-3">
                                <label class="col-form-label" for="salary">Salary</label>
                                <input class="form-control" type="number" 
                                    [ngClass]="{ 'is-invalid': submitted && g['salary'].errors,
                                    'is-valid': submitted && g['salary'].valid }"
                                    formControlName="salary">
                                <div *ngIf="submitted && g['salary']" class="invalid-feedback">
                                    <div *ngIf="g['salary'].errors && g['salary'].errors['required']">Salary is required</div>
                                </div>
                                <div *ngIf="submitted && g['salary'].valid" class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
                    </div>
                    <div class="submit-section">
                        <button class="btn btn-primary submit-btn" type="button" (click)="editContract()">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal custom-modal fade" id="delete_contract" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <h3>Delete Contract</h3>
                    <p>Are you sure want to delete?</p>
                </div>
                <div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
                            <a  class="btn btn-primary continue-btn"
                            (click)="deleteContract()">Delete</a>
                        </div>
                        <div class="col-6">
                            <a  data-bs-dismiss="modal"
                                class="btn btn-primary cancel-btn">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
